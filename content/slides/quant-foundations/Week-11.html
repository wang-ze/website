<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ESC_PS 8850:  Quantitative Foundations in Educational Research</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ze Wang" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# ESC_PS 8850: <br>Quantitative Foundations in Educational Research
## <br/>Monday, 4:00pm-6:30pm; online
### Ze Wang
### University of Missouri
### 2021-11-8

---

layout: true

&lt;div class = 'my-header'&gt;&lt;span&gt;ESC_PS 8850 Quant Foundations&lt;/span&gt;&lt;/div&gt;

&lt;div class = 'my-footer'&gt;&lt;span&gt;wangze@missouri.edu
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
Ze Wang, Ph.D.&lt;/span&gt;&lt;/div&gt; 


---
class: center, middle







# .blue[Week 11]

## .blue[Factorial ANOVA]

---


```r
library(rio); library(ggplot2); library(QuantPsyc); library(psych); library(car); library(interactions); library(memisc); library(multcomp)
```


---

### Factorial Analysis of Variance (Factorial ANOVA)

Factorial ANOVA is used when you have two or more categorical independent variables.

**For exmaple:**

- Is the treatment effect (3 treatments) different for females than for males?
    - [2 (gender) x 3 (treatment) factorial design]

- Is teaching method (4 methods) more effective for high- than for low-ability students?
    - [2 (ability level) x 4 (teaching method) factorial design]

- Is the gender difference on some variable (e.g., math achievement) greater for certain nationalities (American vs. Indonesian) than for others?
    -	[2 (gender) x 2 (nationality) factorial design

You can use this design without treatment variables.  For example, your design could consist of demographic variables only (age by gender; age by ethnicity).


---

### Factorial Analysis of Variance (Factorial ANOVA)

Factorial Design is a good thing (for 3 reasons). 

1. A two-way ANOVA allows us to examine the joint or interactive effect of the two independent variables on the dependent variable.  

2. Factorial designs can lead to more powerful tests by reducing error (within cell) variance.  If performance on the dependent variable is related to the individual difference characteristic (the blocking variable; e.g., gender, ethnicity, age), then the reduction can be substantial.  

3. Economy of participants. We only need half the participants for a two-way ANOVA as would be needed for two one-way ANOVAs with the same number of levels for each factor. 

---

#### A two-way ANOVA allows us to examine the joint or interactive effect of the two independent variables on the dependent variable.  

**Interaction Definitions**

- An interaction is present when the effects of one independent variable on performance change at different levels of the second independent variable.

- An interaction is present when the pattern of differences associated with an independent variable changes at different levels of the other independent variable.

- An interaction is present when the simple effects of one independent variable are not the same at all levels of the second independent variable.

- An interaction is present when the main effect of one independent variable is not representative of the simple effects of that variable.

- An interaction is present when the differences between the cell means representing the effect of factor A at one level of factor B do not equal the corresponding differences at another level of factor B.

- An interaction is present when the effects of one of the independent variables depend on the levels of the other independent variable.

- An interaction is present when one of the effects of one independent variable is not constant 
(not the same) at all levels of the other independent variable.


---

**Interaction **

*Example 1*: The degree of superiority changes, but one subgroup always does better than another.

.pull-left[

```
                   T1       T2       T3     mean
High Ability 85.00000 80.00000 76.00000 80.33333
Low Ability  60.00000 63.00000 68.00000 63.66667
mean         72.50000 71.50000 72.00000 72.00000
```
]

.pull-right[
![](Week-11_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;
]


---

**Interaction **

*Example 2*: The superiority reverses; one treatment is best with one group, but another treatment is better for a different group.


```
         Contract for Grade Teacher Controlled   mean
Internal             50.520             38.010 44.265
External             36.330             46.220 41.275
mean                 43.425             42.115 42.770
```

&lt;img src="Week-11_files/figure-html/unnamed-chunk-7-1.png" width="45%" /&gt;

---

#### Factorial designs can lead to more powerful tests by reducing error (within cell) variance.  If performance on the dependent variable is related to the individual difference characteristic (the blocking variable; e.g., gender, ethnicity, age), then the reduction can be substantial.

**Treatment Only** (variances are inside parentheses)

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; T1 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; T2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; 18, 19, 21, 20, 22, 11, 12, 11, 13, 14 (18.77) &lt;/td&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; 17, 16, 16, 18, 15, 9, 9, 11, 8, 7 (17.6) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**Treatment X Gender** (variances are inside parentheses)

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; `\(T_1\)` &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; `\(T_2\)` &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; Males &lt;/td&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; 18, 19, 21, 20, 22 (2.5) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 17, 16, 16, 18, 15 (1.3) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; Females &lt;/td&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; 11, 12, 11, 13, 14 (1.7) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9, 9, 11, 8, 7 (2.2) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

#### Economy of participants. We only need half the participants for a two-way ANOVA as would be needed for two one-way ANOVAs with the same number of levels for each factor.  

**Two One Way ANOVAs**

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Drug X &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Drug Y &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; DrugZ &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; `\(n = 30\)` &lt;/td&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; `\(n = 30\)` &lt;/td&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; `\(n=30\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; Biofeedback &lt;/td&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; `\(n=45\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; Control &lt;/td&gt;
   &lt;td style="text-align:left;border-left:1px solid;border-right:1px solid;"&gt; `\(n = 45\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**a Two-Way ANOVA** 

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; DrugX &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Drug Y &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Drug Z &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Total &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Biofeedback &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(n=15\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(n=15\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(n=15\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(n=45\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt; Control &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt; `\(n=15\)` &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt; `\(n=15\)` &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt; `\(n=15\)` &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt; `\(n=45\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Total &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(n=30\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(n=30\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(n=30\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---

### Factorial ANOVA

#### Numerical Calcuations for Two-Way ANOVA

We had between and within variation in the one-way design.  In the two-way design, we will have four sources of variation:

1.	Variation due to Factor A (1 independent variable)
2.	Variation due to Factor B (1 independent variable)
3.	Variation due to the interactive effect of A and B (interaction between two independent variables)
4.	Within cell (error) variance


---

### Factorial ANOVA

**Earlier Example:** Reading achievement of 15 children for three experimental training conditions (A = control, B = non-parental training, C = parental training)

Let's call the treatment Factor A. 

We also want to consider the Gender Factor (Factor B).

The mean of each cell and the marginal means look like:

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3"&gt;&lt;div style="border-bottom: 1px solid #111111; margin-bottom: -1px; "&gt;Factor A&lt;/div&gt;&lt;/th&gt;
&lt;th style="empty-cells: hide;" colspan="1"&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Control &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Non-parental training &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Parental training &lt;/th&gt;
   &lt;th style="text-align:center;"&gt;  &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; Boys &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{11}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{12}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{13}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{1.}\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; Girls &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{21}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{22}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{23}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{2.}\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{.1}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{.2}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{.3}\)` &lt;/td&gt;
   &lt;td style="text-align:center;border-left:1px solid;border-right:1px solid;"&gt; `\(\mu _{..}\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

### Factorial ANOVA

**Two-Way ANOVA** allows **two factors** to be included in the same model (J X K groups). A 3 X 2 ANOVA means there are three levels of Factor A and two levels of Factor B.

In a two-way ANOVA, there are two main effects (the effect of one factor that is averaged across the levels of all other factors) and an interaction effect:

- Main Effect for A:  `\({{H}_{0}}:{{\mu }_{.1}}={{\mu }_{.2}}=\cdots ={{\mu }_{.J}}\)`  (population column means are equal, where J = number of levels for Factor A). Is there a significant difference between training groups, holding gender constant?

- Main Effect for B:  `\({{H}_{0}}:{{\mu }_{1.}}={{\mu }_{2.}}=\cdots ={{\mu }_{K.}}\)`  (population row means are equal, where K = number of levels for Factor B). Is there a significant gender difference, holding training conditions constant? 

- Interaction Effect (Factor A X Factor B): ):  `\({{H}_{0}}:{{\varphi }_{ij}}=0\)` for each *i* and *j*, where `\({{\varphi }_{ij}}\)` represents the cell interaction effect (the part of the cell mean that cannot be accounted for by the overall effect/grand mean and by main effects A and B). Are the differences between boys and girls different across different training conditions? Alternatively, are training effects different for boys and girls?

---

### Factorial ANOVA

#### Partitioning the Total Sum of Squares

`$${y_{ijk}} = \mu  + {\alpha _j} + {\beta _k} + {(\alpha \beta )_{jk}} + {\varepsilon _{ijk}}$$`
- `\(\mu  = {\Sigma _j}{\Sigma _k}{\mu _{jk}}/JK\)` is the grand mean 

- `\({\alpha _j} = {\mu _{.j}} - \mu\)` is the effect of the *j*th group of Factor A. The marginal mean `\(mu _{.j}\)` is defined as `\({\mu _{.j}} = {\Sigma _k}{\mu _{jk}}/K\)` where *K* is the number of levels of Factor B.

- `\({\beta _k} = {\mu _{k.}} - \mu\)` is the effect of the *k*th gorup of Factor B. The marignal mean `\(mu _{k.}\)` is defined as `\({\mu _{k.}} = {\Sigma _j}{\mu _{jk}}/J\)` where *J* is the number of levels of Factor A.

- `\({(\alpha \beta )_{jk}} = {\mu _{jk}} - (\mu  + {\alpha _j} + {\beta _k})\)` is the interaction effect, where `\(\mu _{jk}\)` is the cell mean. An interaction effect is teh extent to which each cell mean differs from the additive pattern of the main effects.

- `\({\varepsilon _{ijk}}\)` is the error term which is assumed to be normally distributed (i.e., `\({\varepsilon _{ijk}} \sim N(0,\sigma _\varepsilon ^2)\)`)

---

### Factorial ANOVA

#### Partitioning the Total Sum of Squares

`$${y_{ijk}} = \mu  + {\alpha _j} + {\beta _k} + {(\alpha \beta )_{jk}} + {\varepsilon _{ijk}}$$`

`$$SS{Q_y} = SS{Q_A} + SS{Q_B} + SS{Q_{AB}} + SS{Q_E}$$`

---

### Factorial ANOVA

&lt;table class=" lightable-classic table table-striped" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto; font-size: 16px; margin-left: auto; margin-right: auto;'&gt;
&lt;caption style="font-size: initial !important;"&gt;ANOVA Table for Two-Way ANOVA&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Source of Variaton &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Sum of Squares &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Degrees of Freedom &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Mean Squares &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; `\(F\)` Statistic &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Factor A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(SSQ_A = {nK}\sum\limits_{j = 1}^J {{({\mu _j} - \mu)}^2}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(J-1\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(MS _A = {{SSQ_A} \over {J - 1}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(F = {{MS _A} \over {MS _E}}\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Factor B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(SSQ_B = {nJ}\sum\limits_{k = 1}^K {{({\mu _k} - \mu)}^2}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(K-1\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(MS _B = {{SSQ _B} \over {K-1}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(F = {{MS _B} \over {MS_E}}\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Interaction (A `\(\times\)` B) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(SSQ_{AB} = n\sum\limits_{j}^J {\sum\limits_{k}^K {{({\mu _{jk}} - {\mu _j} - {\mu _k} + {\mu})}^2}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\((J-1)(K-1)\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(MS _{AB} = {{SSQ _{AB}} \over {(J-1)(K-1)}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(F = {{MS _{AB}} \over {MS_E}}\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Error &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(SSQ_E = \sum\limits_{i}^{n} {\sum\limits_{j}^J {\sum\limits_{k}^K {{({\mu _{ijk}} - {\mu _jk})}^2}}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(JK(n-1)\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(MS _E = {{SSQ _E} \over {JK(n-1)}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Total &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(SSQ_y = \sum\limits_{i}^{n} {\sum\limits_{j}^J {\sum\limits_{k}^K {{({\mu _{ijk}} - {\mu})}^2}}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; `\(nJK-1\)` &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Note that `$$R^2 = {{SSQ_A + SSQ_B + SSQ_AB} \over {SSQ_y}}$$`

---

### Factorial ANOVA

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition A &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition B &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition C &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Boys &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 44 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Girls &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


```r
dat &lt;- import("data/reading2.txt")
dat$training &lt;- as.factor(dat$training)
dat$gender &lt;- as.factor(dat$gender)
head(dat)             
```

```
##   reading training gender
## 1      40        A    boy
## 2      33        A    boy
## 3      34        A    boy
## 4      44        A    boy
## 5      48        B    boy
## 6      43        B    boy
```

---

### Factorial ANOVA

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition A &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition B &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition C &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Boys &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 44 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Girls &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**Means of main effects**


```r
aggregate(reading ~ training, data = dat, mean, na.rm = TRUE)
aggregate(reading ~ gender, data = dat, mean, na.rm = TRUE)
```

```
##   training reading
## 1        A  38.250
## 2        B  47.750
## 3        C  42.875
##   gender  reading
## 1    boy 42.16667
## 2   girl 43.75000
```

---

### Factorial ANOVA

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition A &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition B &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition C &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Boys &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 44 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Girls &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**Means of interaction effects**


```r
aggregate(reading ~ training + gender, data = dat, mean, na.rm = TRUE)
```

```
##   training gender reading
## 1        A    boy   37.75
## 2        B    boy   45.00
## 3        C    boy   43.75
## 4        A   girl   38.75
## 5        B   girl   50.50
## 6        C   girl   42.00
```

---

### Factorial ANOVA

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition A &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition B &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Condition C &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Boys &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 44 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Girls &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**Two-Way ANOVA Model**


```r
model &lt;- aov(reading ~ training * gender, data = dat)
summary(model)
```

```
##                 Df Sum Sq Mean Sq F value Pr(&gt;F)  
## training         2  361.1  180.54   4.118 0.0337 *
## gender           1   15.0   15.04   0.343 0.5653  
## training:gender  2   53.6   26.79   0.611 0.5537  
## Residuals       18  789.2   43.85                 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---

### Factorial ANOVA


```r
M &lt;- tapply(dat$reading, list(dat$gender, dat$training), mean)
df &lt;- data.frame(
  treatment=factor(c("A", "A", "B", "B", "C", "C")),
  gender=factor(c("boy", "girl","boy", "girl","boy", "girl")),
  score=as.vector(M)
)

ggplot(data =df, aes(x=treatment, y=score, group = gender, color=gender)) + 
  geom_point() +
  ggtitle("Achievement by Treatment and Gender") + 
  xlab("Treatment Group") +
  ylab("Achievement") +
  geom_line(aes(linetype = gender), size = 1) + 
  theme(legend.title=element_blank())
```

&lt;img src="Week-11_files/figure-html/unnamed-chunk-22-1.png" width="25%" /&gt;

---

### Factorial ANOVA


```r
dat$int &lt;- interaction(dat$training, dat$gender)
ggplot(dat, aes(y=reading, x=int, color=gender)) + 
  geom_boxplot()
```

&lt;img src="Week-11_files/figure-html/unnamed-chunk-23-1.png" width="50%" /&gt;


---

Interpret model results. 

**When interpreting results of models with interaction terms, use Type III Sums of Squares.**


```r
model &lt;- aov(reading ~ training * gender, data = dat)
summary(model)
# anova(model)
*Anova(model, type = "III")
```

```
##                 Df Sum Sq Mean Sq F value Pr(&gt;F)  
## training         2  361.1  180.54   4.118 0.0337 *
## gender           1   15.0   15.04   0.343 0.5653  
## training:gender  2   53.6   26.79   0.611 0.5537  
## Residuals       18  789.2   43.85                 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## Anova Table (Type III tests)
## 
## Response: reading
##                 Sum Sq Df  F value    Pr(&gt;F)    
## (Intercept)     5700.3  1 130.0025 1.144e-09 ***
## training         120.2  2   1.3703    0.2793    
## gender             2.0  1   0.0456    0.8333    
## training:gender   53.6  2   0.6110    0.5537    
## Residuals        789.2 18                       
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


---

### Two-Way ANOVA

Interpret model results. 

- Main effect of training: *F(2,18)* = 1.37, *p* = 0.28. We fail to reject the null hypothesis that there are no differences among the training groups.That is, there are no statistically significant differences among the training groups in reading.

- Main effect of gender: *F(1, 18)* = 0.05, *p*  = .83. We fail to reject the null hypothesis that boys and girls have the same reading scores. That is, there is no statistically significant gender difference in reading. 

- Interaction effect: *F(2, 18)* = 0.61, *p* = 0.55. We fail to reject the null hypothesis that there is no interaction between training and gender. That is, there is no statistically significant interaction between training and gender.

---

### Two-Way ANOVA Assumptions

Assumptions are the same as for one-way ANOVA

**Use `leveneTest` to test variance homogeneity. **

_Levene's test_

```r
leveneTest(reading ~ training * gender, data = dat)
```

```
## Levene's Test for Homogeneity of Variance (center = median)
##       Df F value   Pr(&gt;F)    
## group  5   8.554 0.000272 ***
##       18                     
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---

### Two-Way ANOVA Assumptions

What to do when the homogeneity of variance assumption is violated?

- Run an ANOVA that does not assume equal variances, such as the Kruskal-Wallis test.  
  - The Kruskal-Wallis test is a nonparametric test that is used with an independent groups design employing k samples.  It is used as a substitute for the parametric one-way ANOVA when the assumptions of that test are seriously violated.  The Kruskal-Wallis test does not assume normality, nor homogeneity of variance, as does the parametric ANOVA, and requires only ordinal scaling of the dependent variable (ranked data for the dependent variable).  It is used when violations of normality and/or homogeneity of variance are extreme, or when interval or ratio scaling are not met by the data.  

- Use a more stringent alpha level (e.g., .01, .001)

- Conduct a variance stabilizing transformation (e.g., square root or natural log) to the dependent variable.
---

#### Contrasts using the `multcomp` package

One-Way ANOVA using pairwise contrasts (so-called Tukey contrasts)

```r
#library(multcomp)
model &lt;- aov(reading ~ -1 + training, data = dat) # no intercept to obtain cell means
coef(model)
```

```
## trainingA trainingB trainingC 
##    38.250    47.750    42.875
```

```r
# TukeyHSD(model)
out &lt;- glht(model, linfct=mcp(training="Tukey")) # mean contrasts; mcp - multiple comparison procedures
out
```

```
## 
## 	 General Linear Hypotheses
## 
## Multiple Comparisons of Means: Tukey Contrasts
## 
## 
## Linear Hypotheses:
##            Estimate
## B - A == 0    9.500
## C - A == 0    4.625
## C - B == 0   -4.875
```

---

#### Contrasts using the `multcomp` package

One-Way ANOVA using pairwise contrasts (so-called Tukey contrasts)


```r
confint(out)
```

```
## 
## 	 Simultaneous Confidence Intervals
## 
## Multiple Comparisons of Means: Tukey Contrasts
## 
## 
## Fit: aov(formula = reading ~ -1 + training, data = dat)
## 
## Quantile = 2.5195
## 95% family-wise confidence level
##  
## 
## Linear Hypotheses:
##            Estimate lwr      upr     
## B - A == 0   9.5000   1.4483  17.5517
## C - A == 0   4.6250  -3.4267  12.6767
## C - B == 0  -4.8750 -12.9267   3.1767
```


---

#### Contrasts using the `multcomp` package

One-Way ANOVA using user-defined contrasts.


```r
K &lt;- rbind(c(1,-1/2, -1/2), # control vs. mean of the two treatment groups
           c(0, -1, 1))     # compares the two treatment groups
rownames(K) &lt;- c("control vs treatments", "treatment 1 vs treatment 2")
colnames(K) &lt;- names(coef(model))
# K
out &lt;- glht(model, linfct = K)
out
```

```
## 
## 	 General Linear Hypotheses
## 
## Linear Hypotheses:
##                                 Estimate
## control vs treatments == 0        -7.062
## treatment 1 vs treatment 2 == 0   -4.875
```

```r
summary(out)
```

```
## 
## 	 Simultaneous Tests for General Linear Hypotheses
## 
## Fit: aov(formula = reading ~ -1 + training, data = dat)
## 
## Linear Hypotheses:
##                                 Estimate Std. Error t value Pr(&gt;|t|)  
## control vs treatments == 0        -7.062      2.768  -2.552   0.0364 *
## treatment 1 vs treatment 2 == 0   -4.875      3.196  -1.525   0.2601  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## (Adjusted p values reported -- single-step method)
```

---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (main effects only)**


```r
model2 &lt;- aov(reading ~ gender + training, data = dat)
```

&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Male &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Condition B &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Condition C &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; B - A &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; C - A &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; C - B &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; male - female &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (main effects only)**

```
model2 &lt;- aov(reading ~ gender + training, data = dat)
```

First, extract the appropriate contrast matrices for both factors.


```r
K1 &lt;- glht(model2, linfct= mcp(training = "Tukey"))$linfct
K2 &lt;- glht(model2, linfct= mcp(gender = "Tukey"))$linfct
```

Then, compare levels of each factor simultaneously. 


```r
summary(glht(model2, linfct=rbind(K1, K2)))
```

```
## 
## 	 Simultaneous Tests for General Linear Hypotheses
## 
## Fit: aov(formula = reading ~ gender + training, data = dat)
## 
## Linear Hypotheses:
##                 Estimate Std. Error t value Pr(&gt;|t|)  
## B - A == 0         9.500      3.246   2.927   0.0295 *
## C - A == 0         4.625      3.246   1.425   0.4506  
## C - B == 0        -4.875      3.246  -1.502   0.4065  
## girl - boy == 0    1.583      2.650   0.597   0.9185  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## (Adjusted p values reported -- single-step method)
```

---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (with interaction effect)**

- We may compare the levels of one factor (e.g., training effects)at each level of the other factor (gender). 

- The contrast matrix is now a block-diagonal matrix.


&lt;table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; A &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; B &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; C &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; A &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; B &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; C &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B - A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Female &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C - A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: 1px solid"&gt; C - B &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: 1px solid"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B - A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Male &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C - A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C - B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (with interaction effect)**

- Step 1: Define the contrast matrix:


```r
K &lt;- rbind(c(-1, 1, 0, 0, 0 ,0),
           c(-1, 0, 1, 0, 0 , 0),
           c(0, -1, 1, 0, 0 , 0),
           c(0, 0, 0, -1, 1, 0),
           c(0, 0, 0, -1, 0, 1),
           c(0, 0, 0, 0, -1, 1))
colnames(K) &lt;- rep(c("A", "B", "C"),2)
rownames(K) &lt;- c("boy:B-A", "boy:C-A", "boy:C-B", "girl:B-A", "girl:C-A", "girl:C-B")
K
```

```
##           A  B C  A  B C
## boy:B-A  -1  1 0  0  0 0
## boy:C-A  -1  0 1  0  0 0
## boy:C-B   0 -1 1  0  0 0
## girl:B-A  0  0 0 -1  1 0
## girl:C-A  0  0 0 -1  0 1
## girl:C-B  0  0 0  0 -1 1
```
---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (with interaction effect)**

- Step 2: Estimate auxiliary cell-means model (i.e., model without intercept)


```r
dat$gender.train &lt;- interaction(dat$training, dat$gender)
# head(dat)
model3 &lt;- aov(reading ~ -1 + gender.train, data = dat)
coef(model3)
```

```
##  gender.trainA.boy  gender.trainB.boy  gender.trainC.boy gender.trainA.girl 
##              37.75              45.00              43.75              38.75 
## gender.trainB.girl gender.trainC.girl 
##              50.50              42.00
```

---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (with interaction effect)**

- Step 3: Compute contrasts


```r
out &lt;- glht(model3, linfct = K)
summary(out)
```

```
## 
## 	 Simultaneous Tests for General Linear Hypotheses
## 
## Fit: aov(formula = reading ~ -1 + gender.train, data = dat)
## 
## Linear Hypotheses:
##               Estimate Std. Error t value Pr(&gt;|t|)
## boy:B-A == 0     7.250      4.682   1.548    0.487
## boy:C-A == 0     6.000      4.682   1.281    0.653
## boy:C-B == 0    -1.250      4.682  -0.267    0.998
## girl:B-A == 0   11.750      4.682   2.509    0.103
## girl:C-A == 0    3.250      4.682   0.694    0.943
## girl:C-B == 0   -8.500      4.682  -1.815    0.338
## (Adjusted p values reported -- single-step method)
```

---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (with interaction effect)**

- Step 4: Visualization

*use `plot()` function*


```r
plot(out)
```

&lt;img src="Week-11_files/figure-html/unnamed-chunk-37-1.png" width="40%" /&gt;

---

#### Contrasts using the `multcomp` package

**Two-Way ANOVA (with interaction effect)**

- Step 4: Visualization

*use `ggplot()` function*

```r
ggstatsplot::ggcoefstats(out) + 
  ggplot2::labs(x = "Linear Function", y=NULL)
```

&lt;img src="Week-11_files/figure-html/unnamed-chunk-38-1.png" width="40%" /&gt;


---

#### ANOVA Assumptions

- **Independence of observations**: Observations are assumed to be randomly sampled from a pre-defined target population.
  - Each participant’s score on the dependent variable is not affected by other participants in the same treatment group

- **Normality**: The dependent variable (or the residuals) are assumed to be normally distributed in each sub-population (i.e., in each experimental cell).
  - Visual displays of the data for each group (e.g., with histograms, QQ plots); 
  - Descriptive statistics (e.g., skewness and kurtosis); 
  - Use the Shapiro-Wilk test

- **Variance homogeneity**: The variance is assumed to be the same for each sub-population.
  - use `leveneTest`

---

### Factorial ANOVA as Multiple Regression

The regression model for the 3 X 2 design can be written as:


`$$\begin{array}{l}
\hat Y = a + {b_1}boy + {b_2}condB + {b_3}condC + \\
             {b_4}boy*condB + {b_5}boy*CondC
\end{array}$$`

Where `\({b_1}\)`, `\({b_2}\)`, and `\({b_3}\)`, are the main effects and `\({b_4}\)`, and `\({b_5}\)` are the interaction effects. 

---

### Factorial ANOVA as Multiple Regression


```r
lm1 &lt;- lm(reading~ gender, data = dat)
lm2 &lt;- lm(reading ~ gender + training, data = dat)
lm3 &lt;- lm(reading ~ gender * training, data = dat)
anova(lm1)
```

```
## Analysis of Variance Table
## 
## Response: reading
##           Df  Sum Sq Mean Sq F value Pr(&gt;F)
## gender     1   15.04  15.042  0.2749 0.6053
## Residuals 22 1203.92  54.723
```

```r
anova(lm2)
```

```
## Analysis of Variance Table
## 
## Response: reading
##           Df Sum Sq Mean Sq F value  Pr(&gt;F)  
## gender     1  15.04  15.042  0.3569 0.55692  
## training   2 361.08 180.542  4.2842 0.02828 *
## Residuals 20 842.83  42.142                  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---

### Factorial ANOVA as Multiple Regression


```r
anova(lm3)
```

```
## Analysis of Variance Table
## 
## Response: reading
##                 Df Sum Sq Mean Sq F value  Pr(&gt;F)  
## gender           1  15.04  15.042  0.3430 0.56535  
## training         2 361.08 180.542  4.1175 0.03369 *
## gender:training  2  53.58  26.792  0.6110 0.55368  
## Residuals       18 789.25  43.847                  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
